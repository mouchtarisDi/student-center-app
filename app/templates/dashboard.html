{% extends "base.html" %}
{% block title %}Dashboard | KidsLogix{% endblock %}

{% block content %}
<div class="dash-header">
  <h1 class="dash-title">Welcome to KidsLogix</h1>
  <p class="dash-subtitle">Here you can manage all your student information and sessions.</p>
</div>

<!-- =========================
     STATISTICS (4 cards)
     2x Students per center + 2x Reports expiring per center
========================= -->
<div class="dash-stats">
  {# Students per center #}
  {% for center in centers_order %}
  <a class="stat-card" href="/students?center={{ center }}" aria-label="Students in {{ centers_labels[center] }}">
    <div class="stat-icon stat-icon-blue">
      <span class="material-icons-outlined">group</span>
    </div>
    <div class="stat-body">
      <div class="stat-label">Students</div>
      <div class="stat-sub">{{ centers_labels[center] }}</div>
      <div class="stat-value">{{ student_counts_by_center[center] }}</div>
    </div>
    <span class="material-icons-outlined stat-arrow">chevron_right</span>
  </a>
  {% endfor %}

  {# Reports expiring per center #}
  {% for center in centers_order %}
  <a class="stat-card" href="/students?center={{ center }}" aria-label="Reports expiring in {{ centers_labels[center] }}">
    <div class="stat-icon stat-icon-orange">
      <span class="material-icons-outlined">pending_actions</span>
    </div>
    <div class="stat-body">
      <div class="stat-label">Reports Close to Expire</div>
      <div class="stat-sub">{{ centers_labels[center] }}</div>
      <div class="stat-value">{{ reports_expiring_by_center[center] }}</div>
    </div>
    <span class="material-icons-outlined stat-arrow">chevron_right</span>
  </a>
  {% endfor %}
</div>

<!-- =========================
     PANELS per center (2x2)
     Row1: Program Giannitsa | Reports Giannitsa
     Row2: Program KryaVrisi | Reports KryaVrisi
========================= -->
<div class="dash-grid">

  <!-- =========================
       ROW 1: Programs (2 panels)
  ========================= -->
  {% for center in centers_order %}
  <section class="panel">
    <div class="panel-head">
      <div class="panel-title">
        <span class="material-icons-outlined">schedule</span>
        <div class="panel-title-text">
          <h2>Today's Program</h2>
          <div class="panel-sub">{{ centers_labels[center] }}</div>
        </div>
      </div>
      <a class="panel-link" href="/schedule">
        Open schedule <span class="material-icons-outlined">chevron_right</span>
      </a>
    </div>

    <div class="panel-body panel-body-scroll">
      {% set aps = todays_by_center.get(center, []) %}
      {% if aps and aps|length > 0 %}
        <div class="list">
          {% for ap in aps %}
            <div class="list-row">
              <div class="time-pill">{{ ap.start_time.strftime("%H:%M") }}</div>

              <div class="list-main">
                <div class="list-title">
                  {% if ap.student %}{{ ap.student.full_name }}{% else %}{{ ap.student_amka }}{% endif %}
                </div>
                <div class="list-subtitle">
                  {% if ap.service %}{{ ap.service.name }}{% else %}Service #{{ ap.service_id }}{% endif %}
                </div>
              </div>

              <a class="icon-btn" href="/students/{{ ap.student_amka }}" title="Open student card">
                <span class="material-icons-outlined">chevron_right</span>
              </a>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="empty-state">Δεν υπάρχουν συνεδρίες για σήμερα.</div>
      {% endif %}
    </div>
  </section>
  {% endfor %}

  <!-- =========================
       ROW 2: Reports (2 panels)
  ========================= -->
  {% for center in centers_order %}
  <section class="panel">
    <div class="panel-head">
      <div class="panel-title">
        <span class="material-icons-outlined">pending_actions</span>
        <div class="panel-title-text">
          <h2>Reports Close to Expire</h2>
          <div class="panel-sub">{{ centers_labels[center] }}</div>
        </div>
      </div>
      <a class="panel-link" href="/students?center={{ center }}">
        Open students <span class="material-icons-outlined">chevron_right</span>
      </a>
    </div>

    <div class="panel-body panel-body-scroll">
      {% set reports_list = reports_list_by_center.get(center, []) %}
      {% if reports_list and reports_list|length > 0 %}
        <div class="list">
          {% for st in reports_list %}
            {% set days_left = (st.assessment_expiry_date - today).days %}
            <div class="list-row">
              <div class="warn-pill">
                <span class="material-icons-outlined">warning</span>
              </div>

              <div class="list-main">
                <div class="list-title">{{ st.full_name }}</div>
                <div class="list-subtitle">
                  Expires in <b>{{ days_left }}</b> days • {{ st.assessment_expiry_date.strftime("%d/%m/%Y") }}
                </div>
              </div>

              <a class="icon-btn" href="/students/{{ st.amka }}" title="Open student card">
                <span class="material-icons-outlined">chevron_right</span>
              </a>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="empty-state">Δεν υπάρχουν γνωματεύσεις που λήγουν σύντομα.</div>
      {% endif %}
    </div>
  </section>
  {% endfor %}

</div>
{% endblock %}